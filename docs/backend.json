{
  "entities": {
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product available in the Bharat Bazaar catalog.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the product."
        },
        "categoryId": {
          "type": "string",
          "description": "Reference to Category. (Relationship: Category 1:N Product)"
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the product image.",
          "format": "uri"
        },
        "price": {
          "type": "number",
          "description": "Price of the product."
        },
        "stockQuantity": {
          "type": "number",
          "description": "Current stock quantity of the product."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "categoryId",
        "imageUrl",
        "price",
        "stockQuantity"
      ]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents a category of products.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the category."
        },
        "name": {
          "type": "string",
          "description": "Name of the category."
        },
        "description": {
          "type": "string",
          "description": "Description of the category."
        }
      },
      "required": [
        "id",
        "name",
        "description"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents a customer order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order."
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer. (Relationship: Customer 1:N Order)"
        },
        "orderDate": {
          "type": "string",
          "description": "Date the order was placed.",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "Total amount of the order."
        },
        "status": {
          "type": "string",
          "description": "Status of the order (e.g., pending, processing, shipped, delivered)."
        }
      },
      "required": [
        "id",
        "customerId",
        "orderDate",
        "totalAmount",
        "status"
      ]
    },
    "OrderItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OrderItem",
      "type": "object",
      "description": "Represents an item within an order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order item."
        },
        "orderId": {
          "type": "string",
          "description": "Reference to Order. (Relationship: Order 1:N OrderItem)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N OrderItem)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product in the order item."
        },
        "price": {
          "type": "number",
          "description": "Price of the product at the time of the order."
        }
      },
      "required": [
        "id",
        "orderId",
        "productId",
        "quantity",
        "price"
      ]
    },
    "Customer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Customer",
      "type": "object",
      "description": "Represents a customer of Bharat Bazaar.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the customer."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the customer."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the customer."
        },
        "email": {
          "type": "string",
          "description": "Email address of the customer.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "Phone number of the customer."
        },
        "address": {
          "type": "string",
          "description": "Address of the customer."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "phone",
        "address"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/categories/{categoryId}",
        "definition": {
          "entityName": "Category",
          "schema": {
            "$ref": "#/backend/entities/Category"
          },
          "description": "Stores product categories.  No specific authorization fields are needed as it's assumed public read access is appropriate, but creation/update is limited to admins.",
          "params": [
            {
              "name": "categoryId",
              "description": "Unique identifier for the category."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information.  No specific authorization fields are needed as it's assumed public read access is appropriate, but creation/update is limited to admins.",
          "params": [
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/users/{customerId}",
        "definition": {
          "entityName": "Customer",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Stores customer profiles. Access restricted to the customer themselves and admins.",
          "params": [
            {
              "name": "customerId",
              "description": "Unique identifier for the customer (equal to the Firebase Auth UID)."
            }
          ]
        }
      },
      {
        "path": "/users/{customerId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores customer orders. Path-based ownership restricts access to the customer and admins.",
          "params": [
            {
              "name": "customerId",
              "description": "Unique identifier for the customer."
            },
            {
              "name": "orderId",
              "description": "Unique identifier for the order."
            }
          ]
        }
      },
      {
        "path": "/users/{customerId}/orders/{orderId}/orderItems/{orderItemId}",
        "definition": {
          "entityName": "OrderItem",
          "schema": {
            "$ref": "#/backend/entities/OrderItem"
          },
          "description": "Stores order items associated with an order. Path-based ownership inherited from the parent order.",
          "params": [
            {
              "name": "customerId",
              "description": "Unique identifier for the customer."
            },
            {
              "name": "orderId",
              "description": "Unique identifier for the order."
            },
            {
              "name": "orderItemId",
              "description": "Unique identifier for the order item."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{uid}",
        "definition": {
          "entityName": "adminRole",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Marks a user as an administrator. Existence of document grants admin rights. Note that Customer entity is used for schema to fulfill requirements but should be replaced if applicable",
          "params": [
            {
              "name": "uid",
              "description": "Firebase Auth UID of the administrator."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the Bharat Bazaar application, focusing on product catalog management, order processing, and customer information. The structure prioritizes security, scalability, and ease of maintenance by adhering to the principles of Authorization Independence, Structural Segregation, and Access Modeling. All collections are designed for homogenous security postures.\n\n**Authorization Independence:**  For user-owned data (orders), the `customerId` is used directly in the path (`/users/{customerId}/orders/{orderId}`), avoiding the need for `get()` calls in security rules.  Admin roles are managed through the `/roles_admin/{uid}` collection, relying on document existence for authorization, which is simpler and more scalable than complex role-based data within user documents.\n\n**Structural Segregation:** Product categories and products are stored in separate top-level collections (`/categories` and `/products`) to simplify querying and management. Customer orders are stored within a user-specific subcollection (`/users/{customerId}/orders/{orderId}`), ensuring that only the customer and authorized admins can access the order data.\n\n**Access Modeling:**  Path-based ownership is used for orders (`/users/{customerId}/orders/{orderId}`), providing a secure and efficient way to manage access control. Admin roles are managed via the existence of a document in `/roles_admin/{uid}`.  \n\nThis structure supports the required QAPs by enabling secure `list` operations through structural segregation and path-based ownership. For example, listing orders is restricted to the authenticated user via the `/users/{customerId}/orders` collection. Admin access is controlled by the existence check on `/roles_admin/{uid}`, allowing admins to perform necessary management tasks.\n\nTo facilitate the 'Admin Panel' requirement, create and secure Cloud Functions triggered by changes in the `/products` and `/categories` collections. These functions can handle tasks such as indexing for search, data validation, and triggering notifications. The 'Streamlined Checkout' feature can be implemented using server-side logic (Cloud Functions) triggered by order creation in `/users/{customerId}/orders/{orderId}` to ensure data integrity and security during payment processing.\n\nTo further enhance scalability, consider using subcollections for denormalized data related to products and categories if the data volume increases significantly, enabling efficient querying and updates without impacting overall performance."
  }
}